[gd_resource type="ShaderMaterial" load_steps=4 format=2]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform vec2 bodySize;

uniform mat4 transform;

uniform vec4 color : hint_color = vec4(vec3(1f), .5f);
uniform vec4 surfaceColor : hint_color = vec4(1f);
uniform vec4 bottomColor : hint_color = vec4(vec3(.75f), 1f);
uniform float bottomLength = 16f;
uniform float surfaceLength = 2f;
uniform float surfaceSteps = 8f;
uniform float bottomSteps = 8f;
uniform bool surfaceSmooth = false;

uniform bool distortionEnabled;
uniform sampler2D distortionMap;
uniform vec2 distortionMapTiling = vec2(64f);
uniform vec2 distortionMapMotion = vec2(1f, 0f);
uniform float distortionMapMagnitude = 4f;

varying vec2 v;

void vertex() {
	v = VERTEX;
}

void fragment() {
	vec2 worldV = (transform * vec4(v, 0f, 1f)).xy;
	
	float h = UV.y * bodySize.y;
	float t = h / surfaceLength;
	if (surfaceSmooth) {
		t = 1f - clamp(t, 0f, 1f);
		t = floor(t * surfaceSteps) / surfaceSteps;
	} else {
		t = step(0f, 1f - t);
	}
	COLOR = mix(color, surfaceColor, t);
	t = clamp(h / bottomLength, 0f, 1f);
	t = floor(t * bottomSteps) / bottomSteps;
	COLOR = mix(COLOR, bottomColor, t);
	
	/*if (distortionEnabled) {
		vec2 scUv = SCREEN_UV;
		
		vec2 n = texture(distortionMap, worldV / distortionMapTiling + TIME * distortionMapMotion).rg * 2f - 1f;
		scUv += n * SCREEN_PIXEL_SIZE * distortionMapMagnitude;
		
		scUv = floor(scUv / SCREEN_PIXEL_SIZE) * SCREEN_PIXEL_SIZE;
		scUv += SCREEN_PIXEL_SIZE * .5;
		
		vec4 scColor = textureLod(SCREEN_TEXTURE, scUv, 0f);
		COLOR.rgb = mix(scColor.rgb, COLOR.rgb, COLOR.a);
		COLOR.a = 1f;
	}*/
}



"

[sub_resource type="OpenSimplexNoise" id=2]
octaves = 2

[sub_resource type="NoiseTexture" id=3]
width = 256
height = 256
seamless = true
as_normalmap = true
noise = SubResource( 2 )

[resource]
resource_local_to_scene = true
shader = SubResource( 1 )
shader_param/bodySize = Vector2( 256, 256 )
shader_param/transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0 )
shader_param/color = Color( 0, 0.905882, 1, 0.501961 )
shader_param/surfaceColor = Color( 1, 1, 1, 1 )
shader_param/bottomColor = Color( 0, 0.533333, 0.839216, 0.588235 )
shader_param/bottomLength = 128.0
shader_param/surfaceLength = 2.0
shader_param/surfaceSteps = 8.0
shader_param/bottomSteps = 8.0
shader_param/surfaceSmooth = false
shader_param/distortionEnabled = false
shader_param/distortionMapTiling = Vector2( 64, 64 )
shader_param/distortionMapMotion = Vector2( 0.5, -0.25 )
shader_param/distortionMapMagnitude = 20.0
shader_param/distortionMap = SubResource( 3 )
