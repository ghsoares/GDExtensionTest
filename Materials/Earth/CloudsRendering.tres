[gd_resource type="ShaderMaterial" load_steps=5 format=2]

[ext_resource path="res://Textures/BlueNoises/256_256/HDR_LA_0.png" type="Texture" id=1]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform float bumpness = 32f;
uniform float threshold = .01f;
uniform vec3 lightDirection = vec3(1f, 1f, 0f);
uniform float lightMultiply = 2f;
uniform float lightSteps = 8f;
uniform sampler2D gradient;
uniform sampler2D ditheringTexture;
uniform vec2 ditheringSize = vec2(32f);
uniform float ditheringInfluence;

varying vec2 v;

void vertex() {
	v = VERTEX;
}

void fragment() {
	vec2 spacing = TEXTURE_PIXEL_SIZE;
	float nc = texture(TEXTURE, UV).r;
	float nx = texture(TEXTURE, UV + vec2(spacing.x, 0f)).r - nc;
	float ny = texture(TEXTURE, UV + vec2(0f, spacing.y)).r - nc;
	vec3 n = normalize(vec3(vec2(nx, ny) * bumpness, 1f));
	
	float dither = texture(ditheringTexture, FRAGCOORD.xy / ditheringSize).r * 2f - 1f;
	float d = (dot(n, normalize(lightDirection)) * lightMultiply) * .5f + .5f;
	
	d += dither * ditheringInfluence;
	
	d = floor(d * lightSteps) / (lightSteps - 1f);
	d = clamp(d, 0f, 1f);
	
	/*COLOR.rgb = n * .5f + .5f;
	COLOR.rgb = mix(COLOR.rgb, vec3(d), 1f);*/
	COLOR = texture(gradient, vec2(d, 0f));
	COLOR.a *= nc > threshold ? 1.0 : 0.0;
	
	/*vec2 size = v / UV;
	float b = v.x;
	b = min(b, size.x - v.x);
	b = min(b, v.y);
	b = min(b, size.y - v.y);
	
	b = 1f - b / 4f;
	
	COLOR = mix(COLOR, vec4(1f), step(0f, b));*/
}




"

[sub_resource type="Gradient" id=2]
colors = PoolColorArray( 0.270588, 0.486275, 0.737255, 1, 0.992157, 0.992157, 0.984314, 1 )

[sub_resource type="GradientTexture" id=3]
gradient = SubResource( 2 )

[resource]
shader = SubResource( 1 )
shader_param/bumpness = 16.0
shader_param/threshold = 0.038
shader_param/lightDirection = Vector3( -1, 1, 0 )
shader_param/lightMultiply = 2.722
shader_param/lightSteps = 3.0
shader_param/ditheringSize = Vector2( 256, 256 )
shader_param/ditheringInfluence = 0.09
shader_param/gradient = SubResource( 3 )
shader_param/ditheringTexture = ExtResource( 1 )
